#include <stdio.h>
#include <stdlib.h>
#include <windows.h>
 
typedef struct salesItem 
{
	char description[20];
	int productNumber;
	float price;
	int quantity;
 } myItem;
 
 struct salesItem *pItem;
 
int main(int argc, char *argv[]) 
{
	long* hHeap = HeapCreate(0x00040000, 0, 0);
	char *buffer1, *buffer2, *buffer3;
	
	buffer1 = HeapAlloc(hHeap, 0, 0x10);
	buffer2 = HeapAlloc(hHeap, 0, 0x100);
	struct salesItem myItem;
	
	strcpy(myItem.description, "Sample Item");
	myItem.productNumber=1;
	myItem.price=1.00;
	myItem.quantity=1;
	
	memcpy(buffer2, &myItem, sizeof(struct salesItem));
	
	strcpy(buffer1, argv[1]); // possibly buffer overflow vuln

	// display possibly modified item
	pItem = (struct salesItem*)buffer2;
	printf("My Item is now: %s %f %d", pItem->description, pItem->price, pItem->quantity);
	
	HeapFree(hHeap, 0, buffer2); // could seg fault if buff1 is overflowed
	HeapFree(hHeap, 0, buffer1);
	
	return 0;
}
